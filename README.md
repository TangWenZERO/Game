# 红包链接钱包设计 (Red Pack Wallet)

这是一个基于区块链技术的数字红包应用演示项目，展示了如何在 Web 应用中集成加密货币钱包并与智能合约进行交互。

## 项目概述

本项目是一个基于 Next.js 构建的全栈应用程序，演示了两种主流的以太坊钱包集成方式：

1. 使用 ethers.js 库直接与区块链交互
2. 使用 wagmi + connectkit 提供更高级的 React Hooks 封装

项目核心功能包括：

- 钱包连接（支持 MetaMask 等主流浏览器钱包）
- 红包合约部署与交互
- 红包发放、领取和清空功能
- 实时显示合约状态和交易记录

## 技术栈

- **前端框架**: Next.js 14 (App Router)
- **区块链库**:
  - ethers.js v6
  - wagmi v2
  - viem v2
  - connectkit (钱包连接 UI)
- **样式**: CSS Modules
- **状态管理**: React Query (@tanstack/react-query)
- **部署平台**: Cloudflare Pages
- **智能合约**: Solidity

## 智能合约

项目包含多个 Solidity 智能合约：

### Red.sol - 核心红包合约

这是项目的核心合约，实现了完整的红包功能：

- 支持固定金额和随机金额两种红包模式
- 限制每个地址每 24 小时只能领取一次红包
- 支持合约拥有者存入资金和清空余额
- 事件日志记录关键操作（存款、领取、清空）

主要功能函数：

- `deposit()` - 存入红包资金（仅限合约拥有者）
- `getRedPacked()` - 领取红包
- `clearRedPacked()` - 清空红包余额（仅限合约拥有者）
- `getUser()` - 查询领取记录

### 其他合约

- `LogContract.sol` - 日志相关合约
- `MoclUSDT.sol` - USDT 代币模拟合约
- `TTS.sol` - 另一种代币合约
- `Counter.sol` - 计数器示例合约

## 功能页面

### 主页 (/)

展示项目导航，提供以下技术方案的入口：

1. Ethers.js 钱包集成
2. Wagmi 钱包集成
3. 日志功能演示
4. 酷炫展示页

### Ethers.js 钱包页面 (/ethersPage)

使用 ethers.js 库直接与区块链交互：

- 展示钱包连接/断开功能
- 显示账户地址、网络和余额
- 显示合约状态（拥有者、总余额、红包数量等）
- 支持存入红包资金（仅合约拥有者）
- 支持领取红包和清空红包功能

### Wagmi 钱包页面 (/wagmi)

使用 wagmi + connectkit 集成钱包：

- 更现代化的 UI 组件
- 基于 React Hooks 的状态管理
- 自动化的数据缓存和更新
- 同样的核心功能：连接钱包、查看状态、存入/领取红包

### 日志页面 (/logs)

演示与 USDT 代币合约的交互：

- 兑换 ETH 为 USDT
- 转账 USDT
- 查询 USDT 余额

## 本地开发

### 环境要求

- Node.js >= 18
- pnpm 包管理器
- 支持 Ethereum 的浏览器钱包（如 MetaMask）

### 安装依赖

```bash
pnpm install
```

### 开发服务器

```bash
pnpm dev
```

打开 [http://localhost:3000](http://localhost:3000) 查看应用。

### 构建生产版本

```bash
pnpm build
```

### 部署

项目支持部署到 Cloudflare Pages：

```bash
pnpm deploy
```

## 项目结构

```
red-pack/
├── app/                 # Next.js 应用目录
│   ├── (page)/          # 页面路由
│   │   ├── ethersPage/  # ethers.js 示例页面
│   │   ├── wagmi/       # wagmi 示例页面
│   │   ├── logs/        # 日志功能页面
│   │   └── cool/        # 展示页面
│   ├── abi/             # 合约ABI文件
│   ├── components/      # 公共组件
│   └── utils/           # 工具函数
├── contracts/           # Solidity 智能合约
├── public/              # 静态资源
└── ...
```

## 核心特性

### 钱包集成对比

| 特性     | Ethers.js | Wagmi           |
| -------- | --------- | --------------- |
| 学习曲线 | 较陡峭    | 平缓            |
| 控制程度 | 高        | 中              |
| 代码量   | 多        | 少              |
| 状态管理 | 手动      | 自动            |
| UI 组件  | 需自定义  | ConnectKit 提供 |

### 红包机制

1. **红包类型**：

   - 固定金额红包：每个红包金额相同
   - 随机金额红包：每个红包金额随机分配

2. **领取限制**：

   - 每个地址每 24 小时只能领取一次
   - 红包数量有限，领完即止

3. **权限控制**：
   - 只有合约拥有者可以存入资金
   - 只有合约拥有者可以清空余额

## 注意事项

1. 项目默认连接到 Hardhat 本地测试网络
2. 需要配置 WalletConnect Project ID 以支持 WalletConnect 协议的钱包
3. 合约地址在 utils/utils.ts 中配置
4. 合约 ABI 文件位于 abi/ 目录下

## 扩展方向

1. 添加更多钱包提供商支持
2. 实现红包分享链接功能
3. 增加多代币支持
4. 添加红包过期机制
5. 实现红包退款功能
6. 增加图形化数据分析面板

用来存储 选题数据

选题数据信息为:

{
题目的内容
当前选题 质押的金额
正确答案
参与这个答题的人，多个人
参与答题的人累计质押的金额
}

用户信息：

用户钱包地址：{
钱包地址
质押的金额
答题的金额收益
损失的金额
参与过的答题：[]
创建过的答题：[]
}

需要查询的方法：

1. 获取用户信息信息，根据钱包地址

2. 获取所有选题数据

3. 获取关联用户的 题目数据
